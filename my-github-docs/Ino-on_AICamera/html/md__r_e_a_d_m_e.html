<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ino-on_AICamera: Instructions to Start</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Ino-on_AICamera
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Instructions to Start </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>본 장의 1, 2 가 진행된 라즈베리파이 이미지는 다음 링크에서 다운받을 수 있다. (최소 4GB의 SD카드 필요)</b> <br  />
 </p><blockquote class="doxtable">
<p><a href="http://solution.technonia.com/download/inoon_raspbian_image/PiLite4GB-no-ppp.zip">http://solution.technonia.com/download/inoon_raspbian_image/PiLite4GB-no-ppp.zip</a> <br  />
 </p>
</blockquote>
<p><em>라즈베리파이 계정: pi / raspberry</em> <br  />
 <em>자동로그인 설정은 안 되어 있음!</em> <br  />
</p>
<h2><a class="anchor" id="autotoc_md1"></a>
1. Software Requirements</h2>
<div class="fragment"><div class="line"># Requirements 설치</div>
<div class="line">pi@raspberrypi:~ % sudo apt-get update</div>
<div class="line">pi@raspberrypi:~ % sudo apt-get upgrade</div>
<div class="line">pi@raspberrypi:~ % sudo apt-get install git</div>
<div class="line">pi@raspberrypi:~ % git clone https://github.com/WiringPi/WiringPi</div>
<div class="line">pi@raspberrypi:~ % ./WiringPi/build</div>
<div class="line">pi@raspberrypi:~ % sudo apt-get install libjsoncpp-dev libilmbase-dev libopenexr-dev libgstreamer1.0-dev</div>
<div class="line"> </div>
<div class="line"># OpenCV 4.5 (https://qengineering.eu/install-opencv-4.5-on-raspberry-64-os.html)</div>
<div class="line">pi@raspberrypi:~ % git clone https://github.com/wooseokyourself/raspi-opencv-sh</div>
<div class="line">pi@raspberrypi:~ % cd raspi-opencv-sh</div>
<div class="line">pi@raspberrypi:~/raspi-opencv-sh % chmod 755 opencv.sh</div>
<div class="line">pi@raspberrypi:~ % ./opencv.sh </div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2"></a>
2. Setup raspi-config</h2>
<div class="fragment"><div class="line">pi@raspberrypi:~ $ sudo raspi-config</div>
</div><!-- fragment --><ul>
<li>시리얼 포트 설정 (<a href="https://github.com/codezoo-ltd/CodeZoo_CATM1_Arduino/blob/master/Hands-ON/Cat.M1_RaspberryPi(with%20Python)_HandsON.pdf">reference</a>) <b>모뎀의 시리얼 경로: /dev/ttyS0</b></li>
</ul>
<ol type="1">
<li>Interface Options 선택 <br  />
</li>
<li><a class="el" href="class_serial.html">Serial</a> Port 선택</li>
<li><code>"Would you like a login shell to be accessible over serial?"</code> --&gt; **"No"**</li>
<li><code>"Would you like the serial port hardware to be enabled?"</code> --&gt; **"Yes"**</li>
</ol>
<ul>
<li>카메라 사용 설정</li>
</ul>
<ol type="1">
<li>Interface Options 선택</li>
<li>Camera 선택 및 Enable 설정</li>
</ol>
<ul>
<li>부팅시 자동 로그인 설정</li>
</ul>
<ol type="1">
<li>System Options 선택</li>
<li>Boot / Auto Login 선택</li>
<li>Console Autologin 선택</li>
</ol>
<h2><a class="anchor" id="autotoc_md3"></a>
3. Install Project</h2>
<div class="fragment"><div class="line">pi@raspberrypi:~ $ git clone https://github.com/UmileVX/ino-on_AICamera</div>
<div class="line">pi@raspberrypi:~ $ cd ino-on_AICamera</div>
<div class="line"> </div>
<div class="line"># 처음 clone 시 한 번만 실행.</div>
<div class="line"># ~/.profile 에 부팅시 자동실행 등을 설정하고 모델을 다운받는다.</div>
<div class="line">pi@raspberrypi:~/ino-on_AICamera $ ./init.sh</div>
<div class="line"> </div>
<div class="line"># 매번 컴파일이 필요할때마다 실행.</div>
<div class="line">pi@raspberrypi:~/ino-on_AICamera $ ./build.sh</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4"></a>
4. Run &amp; Test</h2>
<p>라즈베리파이 전원이 켜지면 자동으로 시작된다. 실행을 멈추고싶다면 본 프로그램 실행 중 <code>Ctrl + C</code> 로 인터럽트를 줘야 한다. <br  />
 테스트는 다음과 같이 실행가능하다. </p><div class="fragment"><div class="line">pi@raspberrypi:~/ino-on_AICamera $ ./build/test</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
5. Tuning</h2>
<ul>
<li>라즈베리파이의 부팅속도를 줄이기 위해 dhcp 서버 비활성화 <div class="fragment"><div class="line">pi@raspberrypi:~ $ sudo systemctl disable dhcpcd.service</div>
</div><!-- fragment --> 추후 외부인터넷을 사용할 때 <code>sudo systemctl start dhcpcd.service</code> 가 필요함</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md6"></a>
Informations</h1>
<h2><a class="anchor" id="autotoc_md7"></a>
Raspberry Pi GPIO Pin Number (BCM)</h2>
<ul>
<li>작업 완료 알림: 21 output <br  />
 &gt; HIGH: pi 작업 완료 <br  />
 &gt; LOW: pi 작업 진행중</li>
</ul>
<h2><a class="anchor" id="autotoc_md8"></a>
Yolov4 Configuration (Json)</h2>
<ul>
<li><code>config/config.json</code></li>
<li>각 필드의 의미는 다음과 같다.<ul>
<li>**<code>deviceId</code>** <br  />
 &gt; AICamera 에 부여되는 고유한 ID. ino-on-xxxx 형식을 따름</li>
<li>**<code>sendInterval</code>** <br  />
 &gt; AICamera 의 작동 주기 (초 단위)</li>
<li>**<code>sendOnDetectedOnly</code>** <br  />
 &gt; true 일 경우 이벤트 검출 시에만 사진을 POST, false 일 경우 항상 사진을 POST 하도록 작동</li>
<li>**<code>confidenceThreshold</code>** &gt; 0 - 1 사이의 부동소수점. 낮을수록 False Positive 검출 증가, 높을수록 True Positive 검출 감소</li>
<li>**<code>nmsThreshold</code>** &gt; 0 - 1 사이의 부동소수점. 높을수록 중복 검출 증가</li>
<li>**<code>resizeResolution</code>** &gt; 32 배수의 정수. 낮을수록 검출속도는 빠르나 작은 객체 검출 불리, 높을수록 검출속도는 느리나 작은 객체 검출 유리</li>
<li>**<code>result</code>** <br  />
 &gt; 서버 측의 HTTP request 정상 수신 여부. 1일 경우 정상, 0일 경우 비정상</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md9"></a>
HTTP Request to Server</h2>
<ul>
<li>URL<ul>
<li>HOST: <code><a href="http://ino-on.umilevx.com/api/devices/events/ino-on-xxxx">http://ino-on.umilevx.com/api/devices/events/ino-on-xxxx</a></code> &gt; <code>ino-on-xxxx</code> 는 본 카메라 디바이스의 고유한 아이디를 의미.</li>
<li>서버 로그기록 확인: <a href="http://ino-on.umilevx.com/api/logs/YYYY-MM-DD.log">http://ino-on.umilevx.com/api/logs/YYYY-MM-DD.log</a> &gt; <code>YYYY-MM-DD</code> 는 현재날짜이다.</li>
</ul>
</li>
<li>Format<ul>
<li><code>sendOnDetectedOnly = false</code> 일 경우 <br  />
 ``` { "time"="2021-01-08T13:41:21.046Z" "event"="1" "rssi"="31" "battery"="97" "filename"="2021-01-08.jpg" "files"="@results/2021-01-08.jpg" } ``<code> +</code>sendOnDetectedOnly = true<code>이며 이벤트 미검출일 경우 &lt;br&gt; </code>`` { "time"="2021-01-08T13:41:21.046Z" "event"="0" "rssi"="31" "battery"="97" } ``<code> &gt;</code>time<code>: 사진 촬영 시간 &lt;br&gt; &gt;</code>event<code>: 이벤트 검출 여부 &lt;br&gt; &gt;</code>rssi<code>: 모뎀의 RSSI &lt;br&gt; &gt;</code>battery<code>: NRF에 연결된 배터리 잔여용량 &lt;br&gt; &gt;</code>filename<code>: 서버에 저장될 이미지 파일의 서버 경로이다. &lt;br&gt; &gt;</code>files`: 전송할 이미지 파일의 로컬 경로이다.</li>
</ul>
</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md10"></a>
Resources</h1>
<p><b>Imported</b></p><ul>
<li><a href="http://wiringpi.com/">WiringPi</a></li>
<li><a href="https://opencv.org/">OpenCV</a></li>
<li><a href="http://open-source-parsers.github.io/jsoncpp-docs/doxygen/index.html/">JsonCpp</a></li>
<li><a href="https://github.com/HowardHinnant/date/">Date</a></li>
</ul>
<p><b>Code reference</b></p><ul>
<li><a href="https://github.com/opencv/opencv/blob/master/samples/dnn/object_detection.cpp/">Opencv-dnn-yolo</a></li>
</ul>
<p><b>Others</b></p><ul>
<li><a href="https://www.acidb.ca/">ACID-dateset</a></li>
<li><a href="https://github.com/AlexeyAB/darknet/">Darknet</a></li>
<li><a href="https://github.com/codezoo-ltd/CodeZoo_CATM1_Arduino/">CATM1</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
